odoo.define('pos_price_label.screens', function (require) {

    "use strict";
    var core = require('web.core');
    var gui = require('point_of_sale.gui');
    var models = require('point_of_sale.models');
    var screens = require('point_of_sale.screens');
    //var tools = require('pos_tare.tools');

    var QWeb = core.qweb;

    // This create a new button on top of action widget. This button links to
    // the barcode label printing screen defined below.
    var TareScreenButton = screens.ActionButtonWidget.extend({
        template: 'TareScreenButton',

        button_click: function () {
            this.gui.show_screen('tare');
        },
    });

    screens.define_action_button({
        'name': 'tareScreenButton',
        'widget': TareScreenButton,
    });

    // This is a new screen that reads weight from the electronic scale and
    // create a barcode label encoding the weight. The screen shows a preview
    // of the label. The user is expected to check if the preview matches what's
    // measured on the scale. The barcode image is generated by the report
    // module.
    var TareScreenWidget = screens.ScreenWidget.extend({
        template: 'TareScreenWidget',
        next_screen: 'products',
        previous_screen: 'products',

        show: function () {
            this._super();
            this.render_receipt();
        },
        product_name: function () {
	    var line = this.pos.get_order().get_selected_orderline().get_product().display_name;
	    return line;
	},
        product_quantity: function () {
	    var line = this.pos.get_order().get_selected_orderline().get_quantity();
	    return line;
	},
        product_unit: function () {
	    var line = this.pos.get_order().get_selected_orderline().get_unit().name;
	    return line;
	},
        product_price: function () {
	    var line = this.pos.get_order().get_selected_orderline().get_display_price();
	    return line;
	},
        commercial_name: function () {
	    var line = this.pos.config.company_id[1];
	    return line;
	},
        print_web: function () {
            window.print();
            this.pos.get_order()._printed = true;
        },
        print: function () {
            // See comment in print function of ReceiptScreenWidget
            var self = this;
            setTimeout(function () {
            }, 1000);

            this.print_web();
            this.click_back();
        },
        click_back: function () {
            this.close();
            this.gui.show_screen(this.previous_screen);
        },
        renderElement: function () {
            this._super();
            var self = this;
            this.$('.back').click(function () {
                self.click_back();
            });
            this.$('.print-label').click(function () {
                    self.print();
            });
        },
        render_receipt: function () {
            this.$('.pos-tare-label-container').html(
                QWeb.render('PosTareLabel', {widget:this}));
        },
        close: function () {
            this._super();
        },
    });

    gui.define_screen({name:'tare', widget: TareScreenWidget});

});
